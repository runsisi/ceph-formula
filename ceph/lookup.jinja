{% set pkg = salt['grains.filter_by']({
    'Debian': {
        'pkgs': ['ceph',],
        'manage_repo': True,
        'repos': [
            {'name': 'deb http://ceph.com/debian-giant ' + salt['grains.get']('oscodename') + ' main',
             'humanname': 'ceph',
             'dist': salt['grains.get']('oscodename'),
             'file': '/etc/apt/sources.list.d/ceph.list',
             'key_url': 'https://ceph.com/git/?p=ceph.git;a=blob_plain;f=keys/release.asc',
            },
        ],
    },
    'Deepin': {
        'pkgs': ['ceph',],
        'manage_repo': True,
        'repos': [
            {'name': 'deb http://ceph.com/debian-giant ' + salt['grains.get']('oscodename') + ' main',
             'humanname': 'ceph',
             'dist': salt['grains.get']('oscodename'),
             'file': '/etc/apt/sources.list.d/ceph.list',
             'key_url': 'https://ceph.com/git/?p=ceph.git;a=blob_plain;f=keys/release.asc',
            },
        ],
    },
    'RedHat': {
        'pkgs': ['ceph',],
        'manage_repo': True,
        'repos': [
            {'name': 'ceph',
             'humanname': 'ceph',
             'baseurl': 'http://ceph.com/rpm-giant/el' + salt['grains.get']('osmajorrelease', ['6'])[0] + '/$basearch',
             'gpgcheck': '1',
             'gpgkey': 'https://ceph.com/git/?p=ceph.git;a=blob_plain;f=keys/release.asc',
            },
            {'name': 'ceph-noarch',
             'humanname': 'ceph-noarch',
             'baseurl': 'http://ceph.com/rpm-giant/el' + salt['grains.get']('osmajorrelease', ['6'])[0] + '/noarch',
             'gpgcheck': '1',
             'gpgkey': 'https://ceph.com/git/?p=ceph.git;a=blob_plain;f=keys/release.asc',
            },
        ],
    },
}, grain = 'os_family', merge = salt['pillar.get']('ceph:pkg')) %}

{% set conf = salt['grains.filter_by']({
    'default': {
        'cluster': 'ceph',

        'fsid': '08a80810-eff9-4982-8cf3-37aded9e1802',
        'authentication_type': 'cephx',
        'mon_initial_members': 'hust,',
        'mon_host': 'hust:6789,',
        'public_network': '10.118.4.0/24',
        'cluster_network': '10.118.4.0/24',

        'osd_pool_default_pg_num': '200',
        'osd_pool_default_pgp_num': '200',
        'osd_pool_default_size': '2',
        'osd_pool_default_min_size': '1',
        'osd_crush_chooseleaf_type': '0',

        'mon_key': 'AQATGHJTUCBqIBAA7M2yafV1xctn1pgr3GcKPg==',
        'admin_key': 'AQBMGHJTkC8HKhAAJ7NH255wYypgm1oVuV41MA==',
        'bootstrap_osd_key': 'AQARG3JTsDDEHhAAVinHPiqvJkUi5Mww/URupw==',
        'bootstrap_mds_key': 'AQCztJdSyNb0NBAASA2yPZPuwXeIQnDJ9O8gVw==',
    },
}, merge = salt['pillar.get']('ceph:conf')) %}

{% set mon = salt['grains.filter_by']({
    'default': {
        'mon_id': salt['grains.get']('host'),
    },
}, grain = 'host', merge = salt['pillar.get']('ceph:mon')) %}

{% set osd = salt['grains.filter_by']({
    'default': {
        'osds': [
            {'data': '/ceph1', 'journal': '/tmp/journal1'},
            {'data': '/ceph2',},
        ],
    },
}, grain = 'host', merge = salt['pillar.get']('ceph:osd')) %}
